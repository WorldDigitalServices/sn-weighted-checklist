<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Weighted Checklist</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sn-stylekit@5.3.2/dist/stylekit.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { 
      min-height: 100%; 
      background: var(--sn-stylekit-background-color, #ffffff);
      font-family: var(--sn-stylekit-sans-serif-font, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
      font-size: var(--sn-stylekit-font-size-editor, 16px);
      color: var(--sn-stylekit-foreground-color, #1a1a1a);
      line-height: 1.5;
      -webkit-overflow-scrolling: touch;
    }
    .container { padding: 16px; }
    .add-row { 
      display: flex; 
      gap: 8px; 
      padding-bottom: 12px; 
      border-bottom: 1px solid var(--sn-stylekit-border-color, #e0e0e0); 
      margin-bottom: 12px; 
    }
    .add-input { 
      flex: 1; 
      padding: 12px; 
      font-size: 16px; 
      border: 1px solid var(--sn-stylekit-border-color, #e0e0e0); 
      border-radius: 8px; 
      background: var(--sn-stylekit-background-color, #ffffff); 
      color: var(--sn-stylekit-foreground-color, #1a1a1a); 
      outline: none;
    }
    .add-input:focus { border-color: var(--sn-stylekit-info-color, #086dd6); }
    .add-btn { 
      width: 48px; 
      height: 48px; 
      border: none; 
      border-radius: 8px; 
      background: var(--sn-stylekit-info-color, #086dd6); 
      color: var(--sn-stylekit-info-contrast-color, white); 
      font-size: 24px; 
      cursor: pointer;
    }
    .add-btn:disabled { opacity: 0.4; }
    .items { display: flex; flex-direction: column; gap: 8px; }
    .item { 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      padding: 12px; 
      border: 1px solid; 
      border-left-width: 4px; 
      border-radius: 8px;
    }
    .item.done { 
      opacity: 0.6; 
      background: var(--sn-stylekit-contrast-background-color, #f5f5f5) !important; 
      border-color: var(--sn-stylekit-border-color, #e0e0e0) !important; 
    }
    .check-btn, .weight-btn, .del-btn { 
      width: 44px; 
      height: 44px; 
      min-width: 44px; 
      border: none; 
      border-radius: 6px; 
      background: transparent; 
      font-size: 18px; 
      cursor: pointer;
    }
    .weight-btn:disabled { opacity: 0.3; }
    .del-btn { color: var(--sn-stylekit-neutral-color, #8e8e8e); }
    .del-btn:hover { color: var(--sn-stylekit-danger-color, #d64343); }
    .item-text { flex: 1; word-break: break-word; cursor: text; }
    .item.done .item-text { 
      text-decoration: line-through; 
      color: var(--sn-stylekit-neutral-color, #8e8e8e); 
    }
    .weight-box { display: flex; align-items: center; gap: 4px; }
    .weight-num { 
      min-width: 28px; 
      height: 28px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-size: 14px; 
      font-weight: 600; 
      background: var(--sn-stylekit-contrast-background-color, rgba(0,0,0,0.08)); 
      border-radius: 4px;
    }
    .item.done .weight-box { display: none; }
    .divider { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
      margin: 12px 0; 
      color: var(--sn-stylekit-neutral-color, #8e8e8e); 
      font-size: 13px; 
      text-transform: uppercase;
    }
    .divider::before, .divider::after { 
      content: ''; 
      flex: 1; 
      height: 1px; 
      background: var(--sn-stylekit-border-color, #e0e0e0); 
    }
    .empty { 
      text-align: center; 
      padding: 48px; 
      color: var(--sn-stylekit-neutral-color, #8e8e8e); 
    }
    .edit-input { 
      flex: 1; 
      padding: 8px; 
      font-size: 16px; 
      border: 1px solid var(--sn-stylekit-info-color, #086dd6); 
      border-radius: 4px; 
      background: var(--sn-stylekit-background-color, #ffffff);
      color: var(--sn-stylekit-foreground-color, #1a1a1a);
      outline: none;
    }
  </style>
</head>
<body>
  <div class="container" id="app"></div>

  <script>
    (function() {
      var COLORS = {
        1: { bg: '#e8f0fe', border: '#94a3b8', text: '#475569' },
        2: { bg: '#e0f2fe', border: '#38bdf8', text: '#0369a1' },
        3: { bg: '#fef3c7', border: '#fbbf24', text: '#92400e' },
        4: { bg: '#ffedd5', border: '#fb923c', text: '#c2410c' },
        5: { bg: '#fee2e2', border: '#f87171', text: '#b91c1c' }
      };

      var items = [];
      var editingId = null;
      var STORAGE_KEY = 'wds-weighted-checklist-data';

      function genId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
      }

      function sortItems(arr) {
        var active = [];
        var done = [];
        for (var i = 0; i < arr.length; i++) {
          if (arr[i].done) {
            done.push(arr[i]);
          } else {
            active.push(arr[i]);
          }
        }
        active.sort(function(a, b) { return b.weight - a.weight; });
        return active.concat(done);
      }

      function loadData() {
        try {
          var raw = localStorage.getItem(STORAGE_KEY);
          if (raw) {
            var d = JSON.parse(raw);
            if (d && Array.isArray(d.items)) {
              items = sortItems(d.items);
            }
          }
        } catch (e) {
          items = [];
        }
      }

      function saveData() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify({ version: 1, items: items }));
        } catch (e) {}
      }

      function escapeHtml(text) {
        var div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function render() {
        var app = document.getElementById('app');
        var active = [];
        var done = [];
        
        for (var i = 0; i < items.length; i++) {
          if (items[i].done) {
            done.push(items[i]);
          } else {
            active.push(items[i]);
          }
        }

        var html = '<div class="add-row">';
        html += '<input type="text" class="add-input" id="newItem" placeholder="Add new item...">';
        html += '<button class="add-btn" id="addBtn">+</button>';
        html += '</div>';
        html += '<div class="items">';

        if (items.length === 0) {
          html += '<div class="empty">';
          html += '<p style="font-size:18px;font-weight:500;margin-bottom:4px;">No items yet</p>';
          html += '<p style="opacity:0.7;">Add your first task above</p>';
          html += '</div>';
        }

        for (var i = 0; i < active.length; i++) {
          var item = active[i];
          var c = COLORS[item.weight] || COLORS[3];
          html += '<div class="item" data-id="' + item.id + '" style="background:' + c.bg + ';border-color:' + c.border + ';">';
          html += '<button class="check-btn" data-action="toggle" style="color:' + c.text + ';">&#9744;</button>';
          
          if (editingId === item.id) {
            html += '<input type="text" class="edit-input" id="editInput" value="' + escapeHtml(item.text) + '">';
          } else {
            html += '<span class="item-text" data-action="edit" style="color:' + c.text + ';">' + escapeHtml(item.text) + '</span>';
          }
          
          html += '<div class="weight-box">';
          html += '<button class="weight-btn" data-action="down" style="color:' + c.text + ';"' + (item.weight <= 1 ? ' disabled' : '') + '>&#9660;</button>';
          html += '<span class="weight-num" style="color:' + c.text + ';">' + item.weight + '</span>';
          html += '<button class="weight-btn" data-action="up" style="color:' + c.text + ';"' + (item.weight >= 5 ? ' disabled' : '') + '>&#9650;</button>';
          html += '</div>';
          html += '<button class="del-btn" data-action="delete">&#10005;</button>';
          html += '</div>';
        }

        if (done.length > 0) {
          html += '<div class="divider">Completed</div>';
          for (var j = 0; j < done.length; j++) {
            var doneItem = done[j];
            html += '<div class="item done" data-id="' + doneItem.id + '">';
            html += '<button class="check-btn" data-action="toggle">&#9745;</button>';
            html += '<span class="item-text">' + escapeHtml(doneItem.text) + '</span>';
            html += '<button class="del-btn" data-action="delete">&#10005;</button>';
            html += '</div>';
          }
        }

        html += '</div>';
        app.innerHTML = html;
        attachEvents();
      }

      function attachEvents() {
        var addBtn = document.getElementById('addBtn');
        var newInput = document.getElementById('newItem');
        var editInput = document.getElementById('editInput');

        if (addBtn) {
          addBtn.onclick = function(e) {
            e.preventDefault();
            addItem();
          };
        }
        
        if (newInput) {
          newInput.onkeydown = function(e) {
            if (e.key === 'Enter') {
              e.preventDefault();
              addItem();
            }
          };
        }
        
        if (editInput) {
          editInput.focus();
          editInput.select();
          editInput.onblur = function() { saveEdit(); };
          editInput.onkeydown = function(e) {
            if (e.key === 'Enter') {
              e.preventDefault();
              saveEdit();
            }
          };
        }

        var itemEls = document.querySelectorAll('.item');
        for (var i = 0; i < itemEls.length; i++) {
          (function(itemEl) {
            var id = itemEl.getAttribute('data-id');
            itemEl.onclick = function(e) {
              e.preventDefault();
              var target = e.target;
              var action = target.getAttribute('data-action');
              if (action === 'toggle') toggle(id);
              else if (action === 'edit') startEdit(id);
              else if (action === 'delete') delItem(id);
              else if (action === 'up') changeWeight(id, 1);
              else if (action === 'down') changeWeight(id, -1);
            };
          })(itemEls[i]);
        }
      }

      function addItem() {
        var inp = document.getElementById('newItem');
        if (!inp) return;
        var text = inp.value.trim();
        if (!text) return;
        
        items.push({
          id: genId(),
          text: text,
          weight: 3,
          done: false,
          createdAt: new Date().toISOString()
        });
        items = sortItems(items);
        saveData();
        render();
      }

      function toggle(id) {
        for (var i = 0; i < items.length; i++) {
          if (items[i].id === id) {
            items[i].done = !items[i].done;
            break;
          }
        }
        items = sortItems(items);
        saveData();
        render();
      }

      function changeWeight(id, delta) {
        for (var i = 0; i < items.length; i++) {
          if (items[i].id === id) {
            var newWeight = items[i].weight + delta;
            if (newWeight >= 1 && newWeight <= 5) {
              items[i].weight = newWeight;
            }
            break;
          }
        }
        items = sortItems(items);
        saveData();
        render();
      }

      function delItem(id) {
        var newItems = [];
        for (var i = 0; i < items.length; i++) {
          if (items[i].id !== id) {
            newItems.push(items[i]);
          }
        }
        items = newItems;
        saveData();
        render();
      }

      function startEdit(id) {
        editingId = id;
        render();
      }

      function saveEdit() {
        var inp = document.getElementById('editInput');
        if (inp && inp.value.trim() && editingId) {
          for (var i = 0; i < items.length; i++) {
            if (items[i].id === editingId) {
              items[i].text = inp.value.trim();
              break;
            }
          }
          saveData();
        }
        editingId = null;
        render();
      }

      // Initialize
      loadData();
      render();
    })();
  </script>
</body>
</html>
